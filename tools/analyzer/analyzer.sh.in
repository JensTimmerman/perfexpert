#!@BASH_PROGRAM@
#
# Copyright (c) 2013  University of Texas at Austin. All rights reserved.
#
# $COPYRIGHT$
#
# Additional copyrights may follow
#
# This file is part of PerfExpert.
#
# PerfExpert is free software: you can redistribute it and/or modify it under
# the terms of the GNU Lesser General Public License as published by the Free
# Software Foundation, either version 3 of the License, or (at your option) any
# later version.
#
# PerfExpert is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
# A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
# details.
#
# You should have received a copy of the GNU Lesser General Public License
# along with PerfExpert. If not, see <http://www.gnu.org/licenses/>.
#
# Author: Ashay Rane and Leonardo Fialho
#
# $HEADER$
#

prefix="@prefix@"
exec_prefix="@exec_prefix@"
LIBDIR=@libdir@
ABS_BUILDDIR=@abs_builddir@
ABS_TOP_SRCDIR=@abs_top_srcdir@

# Try to find perfexpert.jar
if [ -f ${LIBDIR}/perfexpert.jar ]; then
    # Probable location after install
    CLASSPATH="${LIBDIR}/perfexpert.jar"
elif [ -f ${ABS_BUILDDIR}/perfexpert.jar ]; then
    # Probable location before install
    CLASSPATH="${ABS_BUILDDIR}/perfexpert.jar"
else
    echo "Unable to find PerfExpert JAR file"
    exit 1
fi

# Try to find argp-1.0.jar
if [ -f ${LIBDIR}/argp-1.0.jar ]; then
    # Probable location after install
    CLASSPATH="${CLASSPATH}:${LIBDIR}/argp-1.0.jar"
elif [ -f ${ABS_BUILDDIR}/argp-1.0.jar ]; then
    # Probable location before install
    CLASSPATH="${CLASSPATH}:${ABS_BUILDDIR}/argp-1.0.jar"
else
    echo "Unable to find ArgP 1.0 JAR file"
    exit 1
fi

# Try to find log4j-1.2.16.jar
if [ -f ${LIBDIR}/log4j-1.2.16.jar ]; then
    # Probable location after install
    CLASSPATH="${CLASSPATH}:${LIBDIR}/log4j-1.2.16.jar"
elif [ -f ${ABS_TOP_SRCDIR}/external/log4j-1.2.16.jar ]; then
    # Probable location before install
    CLASSPATH="${CLASSPATH}:${ABS_TOP_SRCDIR}/external/log4j-1.2.16.jar"
else
    echo "Unable to find Log4J 1.2.16 JAR file"
    exit 1
fi

# Try to find Log4J properties
if [ -f ${LIBDIR}/log4j.properties ]; then
    # Probable location after install
    LOG4J="-Dlog4j.configuration=file:${LIBDIR}/log4j.properties"
elif [ -f ${ABS_TOP_SRCDIR}/external/log4j-1.2.16.jar ]; then
    # Probable location before install
    LOG4J="-Dlog4j.configuration=file:${ABS_TOP_SRCDIR}/external/log4j.properties"
else
    echo "Unable to find Log4J properties file"
    exit 1
fi

export PERFEXPERT_HPCDATA_HOME="${LIBDIR}"
JAVA_TOOL_OPTIONS="-Xms256M -Xmx1G" java ${LOG4J} -cp ${CLASSPATH} edu.utexas.tacc.perfexpert.PerfExpert ${*}
