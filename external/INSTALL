#!/bin/bash

INSTALL_DIR="${HOME}/perfexpert"
PAPI_DIR="${TACC_PAPI_DIR}"
mkdir -p ${INSTALL_DIR}

# export JAVA_HOME=/home1/02204/fialho/work/src/perfexpert/external/jdk1.7.0_25
export JAVA_HOME=/usr/java/latest
export JAVA_BINDIR=$JAVA_HOME/bin
export JAVA_ROOT=$JAVA_HOME
export JRE_HOME=$JAVA_HOME/jre
export PATH=$PATH:${INSTALL_DIR}/bin:$JAVA_BINDIR:$JAVA_HOME/jre/bin
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:${INSTALL_DIR}/lib:$JRE_HOME/lib/amd64/server/

echo "Package: HPCToolKit (externals)"
date
tar -xzvf ./hpctoolkit-externals-5.3.2-r4197.tar.gz
cd hpctoolkit-externals-5.3.2-r4197/
mkdir _build
cd _build
../configure
make
cd ../../

echo "Package: HPCToolKit"
date
tar -xzvf ./hpctoolkit-5.3.2-r4197.tar.gz
cd hpctoolkit-5.3.2-r4197/
mkdir _build
cd _build
module load papi
../configure --prefix=${INSTALL_DIR}/external \
    --with-externals=../../hpctoolkit-externals-5.3.2-r4197/_build/ \
    --with-papi=${PAPI_DIR}
make install
cd ../../

echo "Package: BOOST"
date
tar -xzvf ./boost_1_47_0.tar.gz
cd boost_1_47_0/
./bootstrap.sh
./b2 install --prefix=${INSTALL_DIR}/external
cd ../

echo "Package: ROSE"
date
tar -xzvf ./rose-0.9.5a-without-EDG-20584.tar.gz
cd rose-0.9.5a-20584/
mkdir _build
cd _build
../configure --prefix=${INSTALL_DIR}/external --with-boost=${INSTALL_DIR} \
	--disable-tutorial-directory --disable-projects-directory \
	--disable-tests-directory --disable-opencl --disable-php \
    --disable-cuda --disable-binary-analysis --disable-java \
    --with-gomp_omp_runtime_library=/opt/apps/gcc/4.6.3/lib64/
JAVA_TOOL_OPTIONS="-Xms256M -Xmx1G" make install
cd ../../

echo "Package: Google SparseHash"
date
tar -xzvf ./sparsehash-2.0.2.tar.gz
cd sparsehash-2.0.2/
mkdir _build
cd _build
../configure --prefix=${INSTALL_DIR}/external
make install
cd ../../

echo "Package: GMP"
date
tar -xzvf ./gmp-5.1.2.tar.gz
cd gmp-5.1.2/
mkdir _build
cd _build
../configure --prefix=${INSTALL_DIR}/external
make
make check
make install
cd ../../

echo "Package: Apache ANT"
date
tar -xzvf ./apache-ant-1.9.1-bin.tar.gz
export ANT_HOME=`pwd`/apache-ant-1.9.1
