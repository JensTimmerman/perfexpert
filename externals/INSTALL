#!/bin/bash

INSTALL_DIR="${HOME}/perfexpert/externals"
PAPI_DIR="${TACC_PAPI_DIR}"
mkdir -p ${INSTALL_DIR}

export JRE_HOME=/usr/java/latest/jre
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:${INSTALL_DIR}/lib:$JRE_HOME/lib/amd64/server/

tar -xzvf ./libelf-0.8.13.tar.gz
cd libelf-0.8.13
mkdir _build
cd _build
../configure --prefix=${INSTALL_DIR}
make install
cd ../../

tar -xzvf ./libdwarf-20120410.tar.gz
cd dwarf-20120410/libdwarf
mkdir _build
cd _build
CFLAGS=" -fPIC -I${INSTALL_DIR}/include" \
  LDFLAGS="-L${INSTALL_DIR}/lib" \
  CPPFLAGS="-I${INSTALL_DIR}/include" \
  ../configure --prefix=${INSTALL_DIR} --enable-shared
make
cp libdwarf.so ${INSTALL_DIR}/lib/
cp dwarf.h ${INSTALL_DIR}/include/
cp libdwarf.h ${INSTALL_DIR}/include/
cd ../../..

tar -xzvf ./libmatheval-1.1.11.tar.gz
cd libmatheval-1.1.11
mkdir _build
cd _build
../configure --prefix=${INSTALL_DIR}
make install
cd ../../

tar -xzvf ./sparsehash-2.0.2.tar.gz
cd sparsehash-2.0.2/
mkdir _build
cd _build
../configure --prefix=${INSTALL_DIR}
make install
cd ../../

tar -xzvf ./gmp-5.1.2.tar.gz
cd gmp-5.1.2/
mkdir _build
cd _build
../configure --prefix=${INSTALL_DIR}
make
make check
make install
cd ../../

tar -xzvf ./hpctoolkit-externals-5.3.2-r4197.tar.gz
cd hpctoolkit-externals-5.3.2-r4197/
mkdir _build
cd _build
../configure
make
cd ../../

tar -xzvf ./hpctoolkit-5.3.2-r4197.tar.gz
cd hpctoolkit-5.3.2-r4197/
mkdir _build
cd _build
module load papi
../configure --prefix=${INSTALL_DIR} \
    --with-externals=../../hpctoolkit-externals-5.3.2-r4197/_build/ \
    --with-papi=${PAPI_DIR}
make install
cd ../../

tar -xzvf ./boost_1_47_0.tar.gz
cd boost_1_47_0/
./bootstrap.sh
./b2 install --prefix=${INSTALL_DIR}
cd ../

tar -xzvf ./rose-0.9.5a-without-EDG-20584.tar.gz
cd rose-0.9.5a-20584/
mkdir _build
cd _build
../configure --prefix=${INSTALL_DIR} --with-boost=${INSTALL_DIR} \
	--disable-tutorial-directory --disable-projects-directory \
	--disable-tests-directory --disable-opencl --disable-php \
    --disable-cuda --disable-binary-analysis --disable-java \
    --with-gomp_omp_runtime_library=/opt/apps/gcc/4.6.3/lib64/ \
    --libexecdir=/tmp --bindir=/tmp --sbindir=/tmp
cd ../../
